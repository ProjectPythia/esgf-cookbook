{"version":2,"kind":"Notebook","sha256":"906f5b8e07a11440bb18a8cc8345b3fd019663188e817663d1bdc625d4259a17","slug":"notebooks.complex-search2-and-analysis","location":"/notebooks/complex-search2-and-analysis.ipynb","dependencies":[],"frontmatter":{"title":"Complex Searching with intake and analysing employing xarray","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Project Pythia Community","given":"Project Pythia","family":"Community"},"name":"Project Pythia Community","url":"https://projectpythia.org/","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true},"code":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true}},"github":"https://github.com/projectpythia/esgf-cookbook","copyright":"2023","affiliations":[{"id":"University at Albany (State University of New York)","name":"University at Albany (State University of New York)"},{"id":"UCAR/NCAR","name":"UCAR/NCAR"}],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/projectpythia/esgf-cookbook/blob/main/notebooks/complex-search2-and-analysis.ipynb","thumbnail":"/esgf-cookbook/build/esgf2-us-2eeff5d395e10e9956f0760c42c08786.png","exports":[{"format":"ipynb","filename":"complex-search2-and-analysis.ipynb","url":"/esgf-cookbook/build/complex-search2-and--12c1899d79ff11cf92fd55293de80bc2.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"image","url":"/esgf-cookbook/build/esgf2-us-2eeff5d395e10e9956f0760c42c08786.png","alt":"ESGF logo","width":250,"key":"FS522BVVDl","urlSource":"images/logos/esgf2-us.png"}],"key":"F0GZWyxM18"}],"visibility":"show","key":"rD9UKWO8n2"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Complex Searching with ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VA1JWk1gc7"},{"type":"inlineCode","value":"intake","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"W1OaPZj1Ro"},{"type":"text","value":" and analysing employing ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rY8ymJ0Tj7"},{"type":"inlineCode","value":"xarray","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dx7K4mEduR"}],"identifier":"complex-searching-with-intake-and-analysing-employing-xarray","label":"Complex Searching with intake and analysing employing xarray","html_id":"complex-searching-with-intake-and-analysing-employing-xarray","implicit":true,"key":"EovdenwptZ"},{"type":"heading","depth":2,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rPDZwxeU9E"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"e6nXb7TZ4W"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"This tutorial we will present access multiple historical (as an example here) data available and analyze  using ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"DIRxOAAIRq"},{"type":"inlineCode","value":"intake","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"qboSxVQnfk"},{"type":"text","value":". Put them in a dictionary format employing ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"D2z4X87iqX"},{"type":"inlineCode","value":"xarray","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Pcnpb46rB1"},{"type":"text","value":" and plotting simple area average time series over a specific region.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Gd2e2YlyHV"}],"key":"VNiyjCGpdr"},{"type":"heading","depth":2,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"padKBTjZEh"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"lkHvXtpfa3"}],"key":"IdHOjl80Uw"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import warnings\nimport intake\nfrom distributed import Client\nfrom matplotlib import pyplot as plt\nimport numpy as np\nimport pandas as pd\nimport xarray as xr\nimport dask\nxr.set_options(display_style='html')\nwarnings.filterwarnings(\"ignore\")","visibility":"show","key":"dJYwTZo4Ak"},{"type":"output","id":"I8KfWDLxVhCccErHsFvj0","data":[],"visibility":"show","key":"qetgaxcXAE"}],"visibility":"show","key":"U7xRHHdOW9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cat_url = \"https://storage.googleapis.com/cmip6/pangeo-cmip6.json\"\ncol = intake.open_esm_datastore(cat_url)\ncol","key":"dP7WXtmwpE"},{"type":"output","id":"3UqTwm7xjQwOooDRMZ835","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"},"text/html":{"content":"<p><strong>pangeo-cmip6 catalog with 7674 dataset(s) from 514818 asset(s)</strong>:</p> <div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>unique</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>activity_id</th>\n      <td>18</td>\n    </tr>\n    <tr>\n      <th>institution_id</th>\n      <td>36</td>\n    </tr>\n    <tr>\n      <th>source_id</th>\n      <td>88</td>\n    </tr>\n    <tr>\n      <th>experiment_id</th>\n      <td>170</td>\n    </tr>\n    <tr>\n      <th>member_id</th>\n      <td>657</td>\n    </tr>\n    <tr>\n      <th>table_id</th>\n      <td>37</td>\n    </tr>\n    <tr>\n      <th>variable_id</th>\n      <td>700</td>\n    </tr>\n    <tr>\n      <th>grid_label</th>\n      <td>10</td>\n    </tr>\n    <tr>\n      <th>zstore</th>\n      <td>514818</td>\n    </tr>\n    <tr>\n      <th>dcpp_init_year</th>\n      <td>60</td>\n    </tr>\n    <tr>\n      <th>version</th>\n      <td>736</td>\n    </tr>\n    <tr>\n      <th>derived_variable_id</th>\n      <td>0</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"}}}],"key":"OpK7vs8Rx2"}],"key":"dD3kIlFgBp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cat = col.search(experiment_id=[\"historical\"],\n    variable_id = [\"tas\"],\n    member_id = [\"r1i1p1f1\"],\n    table_id = [\"Amon\",], \n    source_id = [ \"CMCC-ESM2\", \"CanESM5\", \"CESM2\", \"CESM2-FV2\", ]\n)","key":"W8UkWpGkyT"},{"type":"output","id":"9IRzpEIZ6VDRj4rw2oqSV","data":[],"key":"UBrNQHNRcM"}],"key":"RTjjyAKOII"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cat.df","key":"O6VZ033AI3"},{"type":"output","id":"7Q19PoSGlhQkSlKrHvRqc","data":[{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/plain":{"content":"  activity_id institution_id  source_id experiment_id member_id table_id  \\\n0        CMIP           NCAR      CESM2    historical  r1i1p1f1     Amon   \n1        CMIP          CCCma    CanESM5    historical  r1i1p1f1     Amon   \n2        CMIP           NCAR  CESM2-FV2    historical  r1i1p1f1     Amon   \n3        CMIP           CMCC  CMCC-ESM2    historical  r1i1p1f1     Amon   \n\n  variable_id grid_label                                             zstore  \\\n0         tas         gn  gs://cmip6/CMIP6/CMIP/NCAR/CESM2/historical/r1...   \n1         tas         gn  gs://cmip6/CMIP6/CMIP/CCCma/CanESM5/historical...   \n2         tas         gn  gs://cmip6/CMIP6/CMIP/NCAR/CESM2-FV2/historica...   \n3         tas         gn  gs://cmip6/CMIP6/CMIP/CMCC/CMCC-ESM2/historica...   \n\n   dcpp_init_year   version  \n0             NaN  20190308  \n1             NaN  20190429  \n2             NaN  20191120  \n3             NaN  20210114  ","content_type":"text/plain"},"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>activity_id</th>\n      <th>institution_id</th>\n      <th>source_id</th>\n      <th>experiment_id</th>\n      <th>member_id</th>\n      <th>table_id</th>\n      <th>variable_id</th>\n      <th>grid_label</th>\n      <th>zstore</th>\n      <th>dcpp_init_year</th>\n      <th>version</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>CMIP</td>\n      <td>NCAR</td>\n      <td>CESM2</td>\n      <td>historical</td>\n      <td>r1i1p1f1</td>\n      <td>Amon</td>\n      <td>tas</td>\n      <td>gn</td>\n      <td>gs://cmip6/CMIP6/CMIP/NCAR/CESM2/historical/r1...</td>\n      <td>NaN</td>\n      <td>20190308</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>CMIP</td>\n      <td>CCCma</td>\n      <td>CanESM5</td>\n      <td>historical</td>\n      <td>r1i1p1f1</td>\n      <td>Amon</td>\n      <td>tas</td>\n      <td>gn</td>\n      <td>gs://cmip6/CMIP6/CMIP/CCCma/CanESM5/historical...</td>\n      <td>NaN</td>\n      <td>20190429</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>CMIP</td>\n      <td>NCAR</td>\n      <td>CESM2-FV2</td>\n      <td>historical</td>\n      <td>r1i1p1f1</td>\n      <td>Amon</td>\n      <td>tas</td>\n      <td>gn</td>\n      <td>gs://cmip6/CMIP6/CMIP/NCAR/CESM2-FV2/historica...</td>\n      <td>NaN</td>\n      <td>20191120</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>CMIP</td>\n      <td>CMCC</td>\n      <td>CMCC-ESM2</td>\n      <td>historical</td>\n      <td>r1i1p1f1</td>\n      <td>Amon</td>\n      <td>tas</td>\n      <td>gn</td>\n      <td>gs://cmip6/CMIP6/CMIP/CMCC/CMCC-ESM2/historica...</td>\n      <td>NaN</td>\n      <td>20210114</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"}}}],"key":"SKclUrkxBN"}],"key":"piSy61wHlj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"dset_dict = cat.to_dataset_dict(zarr_kwargs={'consolidated': True})\nlist(dset_dict.keys())","key":"ZyjakR6dQ4"},{"type":"output","id":"9n8bhrrGUsQ-RVpYEkoOa","data":[{"output_type":"stream","name":"stdout","text":"\n--> The keys in the returned dictionary of datasets are constructed as follows:\n\t'activity_id.institution_id.source_id.experiment_id.table_id.grid_label'\n"},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"},"text/html":{"content":"\n<style>\n    /* Turns off some styling */\n    progress {\n        /* gets rid of default border in Firefox and Opera. */\n        border: none;\n        /* Needs to be in here for Safari polyfill so background images work as expected. */\n        background-size: auto;\n    }\n    progress:not([value]), progress:not([value])::-webkit-progress-bar {\n        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);\n    }\n    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {\n        background: #F44336;\n    }\n</style>\n","content_type":"text/html"}}},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"},"text/html":{"content":"\n    <div>\n      <progress value='0' class='' max='4' style='width:300px; height:20px; vertical-align: middle;'></progress>\n      \n    </div>\n    ","content_type":"text/html"}}},{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"['CMIP.CMCC.CMCC-ESM2.historical.Amon.gn',\n 'CMIP.CCCma.CanESM5.historical.Amon.gn',\n 'CMIP.NCAR.CESM2-FV2.historical.Amon.gn',\n 'CMIP.NCAR.CESM2.historical.Amon.gn']","content_type":"text/plain"}}}],"key":"kBraAeYQlC"}],"key":"TdZqgiCU94"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ds = {}\n\nfor key in dset_dict.keys():\n    # Sort the dataset by time\n    sorted_dataset = dset_dict[key].sortby(\"time\")\n    \n    # Subset data for years 1900-2000\n    ds[key] = sorted_dataset.sel(time=slice(\"1900\", \"2000\"))\n        \n    # Optional: Print a message indicating dataset processing\n    print(f\"Processing dataset: {key}\")\n","visibility":"show","key":"XLhkniD2sn"},{"type":"output","id":"fcgiYPDBoUVvV393Ktotn","data":[{"output_type":"stream","name":"stdout","text":"Processing dataset: CMIP.CMCC.CMCC-ESM2.historical.Amon.gn\nProcessing dataset: CMIP.CCCma.CanESM5.historical.Amon.gn\nProcessing dataset: CMIP.NCAR.CESM2-FV2.historical.Amon.gn\nProcessing dataset: CMIP.NCAR.CESM2.historical.Amon.gn\n"}],"visibility":"show","key":"U2mznBvmuh"}],"visibility":"show","key":"ewZjAwBqMS"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"inlineCode","value":"ds","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"D6NwaWE0Zf"},{"type":"text","value":" now contains subset of datasets for each key in dset_dict","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sSJfzoQLAb"}],"key":"GtoLoz6Lfu"}],"key":"fvrKgp2zXw"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Let’s check ds","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"x0KlcQB9i3"}],"key":"TLB6YP18vU"}],"key":"Z77Vwdk43y"}],"key":"wpCT71MqWK"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ds","visibility":"show","key":"bFZwzPOlmy"},{"type":"output","id":"E5E_yb7g42HwDQQkZQwEt","data":[{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/plain":{"content":"{'CMIP.CMCC.CMCC-ESM2.historical.Amon.gn': <xarray.Dataset> Size: 268MB\n Dimensions:         (lat: 192, bnds: 2, lon: 288, member_id: 1,\n                      dcpp_init_year: 1, time: 1212)\n Coordinates:\n     height          float64 8B ...\n   * lat             (lat) float64 2kB -90.0 -89.06 -88.12 ... 88.12 89.06 90.0\n     lat_bnds        (lat, bnds) float64 3kB dask.array<chunksize=(192, 2), meta=np.ndarray>\n   * lon             (lon) float64 2kB 0.0 1.25 2.5 3.75 ... 356.2 357.5 358.8\n     lon_bnds        (lon, bnds) float64 5kB dask.array<chunksize=(288, 2), meta=np.ndarray>\n   * time            (time) object 10kB 1900-01-16 12:00:00 ... 2000-12-16 12:...\n     time_bnds       (time, bnds) object 19kB dask.array<chunksize=(1212, 2), meta=np.ndarray>\n   * member_id       (member_id) object 8B 'r1i1p1f1'\n   * dcpp_init_year  (dcpp_init_year) float64 8B nan\n Dimensions without coordinates: bnds\n Data variables:\n     tas             (member_id, dcpp_init_year, time, lat, lon) float32 268MB dask.array<chunksize=(1, 1, 208, 192, 288), meta=np.ndarray>\n Attributes: (12/64)\n     Conventions:                      CF-1.7 CMIP-6.2\n     activity_id:                      CMIP\n     branch_method:                    standard\n     branch_time_in_child:             0.0\n     branch_time_in_parent:            0.0\n     cmor_version:                     3.6.0\n     ...                               ...\n     intake_esm_attrs:variable_id:     tas\n     intake_esm_attrs:grid_label:      gn\n     intake_esm_attrs:zstore:          gs://cmip6/CMIP6/CMIP/CMCC/CMCC-ESM2/hi...\n     intake_esm_attrs:version:         20210114\n     intake_esm_attrs:_data_format_:   zarr\n     intake_esm_dataset_key:           CMIP.CMCC.CMCC-ESM2.historical.Amon.gn,\n 'CMIP.CCCma.CanESM5.historical.Amon.gn': <xarray.Dataset> Size: 40MB\n Dimensions:         (lat: 64, bnds: 2, lon: 128, member_id: 1,\n                      dcpp_init_year: 1, time: 1212)\n Coordinates:\n     height          float64 8B ...\n   * lat             (lat) float64 512B -87.86 -85.1 -82.31 ... 82.31 85.1 87.86\n     lat_bnds        (lat, bnds) float64 1kB dask.array<chunksize=(64, 2), meta=np.ndarray>\n   * lon             (lon) float64 1kB 0.0 2.812 5.625 ... 351.6 354.4 357.2\n     lon_bnds        (lon, bnds) float64 2kB dask.array<chunksize=(128, 2), meta=np.ndarray>\n   * time            (time) object 10kB 1900-01-16 12:00:00 ... 2000-12-16 12:...\n     time_bnds       (time, bnds) object 19kB dask.array<chunksize=(1212, 2), meta=np.ndarray>\n   * member_id       (member_id) object 8B 'r1i1p1f1'\n   * dcpp_init_year  (dcpp_init_year) float64 8B nan\n Dimensions without coordinates: bnds\n Data variables:\n     tas             (member_id, dcpp_init_year, time, lat, lon) float32 40MB dask.array<chunksize=(1, 1, 600, 64, 128), meta=np.ndarray>\n Attributes: (12/69)\n     CCCma_model_hash:                 3dedf95315d603326fde4f5340dc0519d80d10c0\n     CCCma_parent_runid:               rc3-pictrl\n     CCCma_pycmor_hash:                33c30511acc319a98240633965a04ca99c26427e\n     CCCma_runid:                      rc3.1-his01\n     Conventions:                      CF-1.7 CMIP-6.2\n     YMDH_branch_time_in_child:        1850:01:01:00\n     ...                               ...\n     intake_esm_attrs:variable_id:     tas\n     intake_esm_attrs:grid_label:      gn\n     intake_esm_attrs:zstore:          gs://cmip6/CMIP6/CMIP/CCCma/CanESM5/his...\n     intake_esm_attrs:version:         20190429\n     intake_esm_attrs:_data_format_:   zarr\n     intake_esm_dataset_key:           CMIP.CCCma.CanESM5.historical.Amon.gn,\n 'CMIP.NCAR.CESM2-FV2.historical.Amon.gn': <xarray.Dataset> Size: 67MB\n Dimensions:         (lat: 96, nbnd: 2, lon: 144, member_id: 1,\n                      dcpp_init_year: 1, time: 1212)\n Coordinates:\n   * lat             (lat) float64 768B -90.0 -88.11 -86.21 ... 86.21 88.11 90.0\n     lat_bnds        (lat, nbnd) float64 2kB dask.array<chunksize=(96, 2), meta=np.ndarray>\n   * lon             (lon) float64 1kB 0.0 2.5 5.0 7.5 ... 352.5 355.0 357.5\n     lon_bnds        (lon, nbnd) float64 2kB dask.array<chunksize=(144, 2), meta=np.ndarray>\n   * time            (time) object 10kB 1900-01-15 12:00:00 ... 2000-12-15 12:...\n     time_bnds       (time, nbnd) object 19kB dask.array<chunksize=(1212, 2), meta=np.ndarray>\n   * member_id       (member_id) object 8B 'r1i1p1f1'\n   * dcpp_init_year  (dcpp_init_year) float64 8B nan\n Dimensions without coordinates: nbnd\n Data variables:\n     tas             (member_id, dcpp_init_year, time, lat, lon) float32 67MB dask.array<chunksize=(1, 1, 390, 96, 144), meta=np.ndarray>\n Attributes: (12/61)\n     Conventions:                      CF-1.7 CMIP-6.2\n     activity_id:                      CMIP\n     branch_method:                    standard\n     branch_time_in_child:             674885.0\n     branch_time_in_parent:            10950.0\n     case_id:                          1559\n     ...                               ...\n     intake_esm_attrs:variable_id:     tas\n     intake_esm_attrs:grid_label:      gn\n     intake_esm_attrs:zstore:          gs://cmip6/CMIP6/CMIP/NCAR/CESM2-FV2/hi...\n     intake_esm_attrs:version:         20191120\n     intake_esm_attrs:_data_format_:   zarr\n     intake_esm_dataset_key:           CMIP.NCAR.CESM2-FV2.historical.Amon.gn,\n 'CMIP.NCAR.CESM2.historical.Amon.gn': <xarray.Dataset> Size: 268MB\n Dimensions:         (lat: 192, nbnd: 2, lon: 288, member_id: 1,\n                      dcpp_init_year: 1, time: 1212)\n Coordinates:\n   * lat             (lat) float64 2kB -90.0 -89.06 -88.12 ... 88.12 89.06 90.0\n     lat_bnds        (lat, nbnd) float32 2kB dask.array<chunksize=(192, 2), meta=np.ndarray>\n   * lon             (lon) float64 2kB 0.0 1.25 2.5 3.75 ... 356.2 357.5 358.8\n     lon_bnds        (lon, nbnd) float32 2kB dask.array<chunksize=(288, 2), meta=np.ndarray>\n   * time            (time) object 10kB 1900-01-15 12:00:00 ... 2000-12-15 12:...\n     time_bnds       (time, nbnd) object 19kB dask.array<chunksize=(1212, 2), meta=np.ndarray>\n   * member_id       (member_id) object 8B 'r1i1p1f1'\n   * dcpp_init_year  (dcpp_init_year) float64 8B nan\n Dimensions without coordinates: nbnd\n Data variables:\n     tas             (member_id, dcpp_init_year, time, lat, lon) float32 268MB dask.array<chunksize=(1, 1, 600, 192, 288), meta=np.ndarray>\n Attributes: (12/61)\n     Conventions:                      CF-1.7 CMIP-6.2\n     activity_id:                      CMIP\n     branch_method:                    standard\n     branch_time_in_child:             674885.0\n     branch_time_in_parent:            219000.0\n     case_id:                          15\n     ...                               ...\n     intake_esm_attrs:variable_id:     tas\n     intake_esm_attrs:grid_label:      gn\n     intake_esm_attrs:zstore:          gs://cmip6/CMIP6/CMIP/NCAR/CESM2/histor...\n     intake_esm_attrs:version:         20190308\n     intake_esm_attrs:_data_format_:   zarr\n     intake_esm_dataset_key:           CMIP.NCAR.CESM2.historical.Amon.gn}","content_type":"text/plain"}}}],"visibility":"show","key":"SLaNBjWi2J"}],"visibility":"show","key":"AtkVvWvsCm"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Calculate regional mean for each dataset and visualizing time series","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AOBhMcyRfs"}],"identifier":"calculate-regional-mean-for-each-dataset-and-visualizing-time-series","label":"Calculate regional mean for each dataset and visualizing time series","html_id":"calculate-regional-mean-for-each-dataset-and-visualizing-time-series","implicit":true,"key":"matZ6HXvDg"}],"key":"RG3hYDWioc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"regn_mean = {} \nfor key in dset_dict.keys():\n    regn_mean[key] = ds[key]['tas'].sel(lon=slice(65, 100), lat=slice(5, 25)).mean(dim=['lon', 'lat']).squeeze()\n","key":"btUuqn706I"},{"type":"output","id":"BXKVpLVdQWvN2TL2pmFGV","data":[],"key":"goaZwFFNEQ"}],"key":"q9466J95vl"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"regn_mean","visibility":"show","key":"m0hMpHoQmb"},{"type":"output","id":"5al_yC69y_k9FH9LlEy6H","data":[{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"{'CMIP.CMCC.CMCC-ESM2.historical.Amon.gn': <xarray.DataArray 'tas' (time: 1212)> Size: 5kB\n dask.array<getitem, shape=(1212,), dtype=float32, chunksize=(404,), chunktype=numpy.ndarray>\n Coordinates:\n     height          float64 8B ...\n   * time            (time) object 10kB 1900-01-16 12:00:00 ... 2000-12-16 12:...\n     member_id       <U8 32B 'r1i1p1f1'\n     dcpp_init_year  float64 8B nan,\n 'CMIP.CCCma.CanESM5.historical.Amon.gn': <xarray.DataArray 'tas' (time: 1212)> Size: 5kB\n dask.array<getitem, shape=(1212,), dtype=float32, chunksize=(600,), chunktype=numpy.ndarray>\n Coordinates:\n     height          float64 8B ...\n   * time            (time) object 10kB 1900-01-16 12:00:00 ... 2000-12-16 12:...\n     member_id       <U8 32B 'r1i1p1f1'\n     dcpp_init_year  float64 8B nan,\n 'CMIP.NCAR.CESM2-FV2.historical.Amon.gn': <xarray.DataArray 'tas' (time: 1212)> Size: 5kB\n dask.array<getitem, shape=(1212,), dtype=float32, chunksize=(822,), chunktype=numpy.ndarray>\n Coordinates:\n   * time            (time) object 10kB 1900-01-15 12:00:00 ... 2000-12-15 12:...\n     member_id       <U8 32B 'r1i1p1f1'\n     dcpp_init_year  float64 8B nan,\n 'CMIP.NCAR.CESM2.historical.Amon.gn': <xarray.DataArray 'tas' (time: 1212)> Size: 5kB\n dask.array<getitem, shape=(1212,), dtype=float32, chunksize=(600,), chunktype=numpy.ndarray>\n Coordinates:\n   * time            (time) object 10kB 1900-01-15 12:00:00 ... 2000-12-15 12:...\n     member_id       <U8 32B 'r1i1p1f1'\n     dcpp_init_year  float64 8B nan}","content_type":"text/plain"}}}],"visibility":"show","key":"EX7sDKAr14"}],"visibility":"show","key":"FSnVsTkKzT"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"plt.rcParams['figure.figsize'] = [15, 4]\nplt.rcParams['lines.linewidth'] = 2\nplt.rcParams['font.size'] = 10\nplt.rcParams['font.weight'] = 'bold'\n","visibility":"show","key":"SbTZQce8iX"},{"type":"output","id":"rBbJnKAe0nbUENh5UqK72","data":[],"visibility":"show","key":"mCrIJc24wg"}],"visibility":"show","key":"nnlgIstHyD"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualizing the regional mean for each dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LRjA0ir8qK"}],"identifier":"visualizing-the-regional-mean-for-each-dataset","label":"Visualizing the regional mean for each dataset","html_id":"visualizing-the-regional-mean-for-each-dataset","implicit":true,"key":"rAmC3W9g6a"}],"visibility":"show","key":"y6U8uWgT4S"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"for key, regm in regn_mean.items():\n    source_id = key.split('.')[2]\n    regm.plot(label=source_id)\n    plt.title(f\"Mean Surface Air Temperature for {source_id}\")\n    plt.xlabel('Time')\n    plt.ylabel('Temperature (K)')\n    plt.legend()\n    plt.show()","key":"UJoZsrpLLZ"},{"type":"output","id":"uyBLHLl4ibj_yfCH8Fy8v","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1500x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"5a88bdc3a25cfca64abd9b4fff64600b","path":"/esgf-cookbook/build/5a88bdc3a25cfca64abd9b4fff64600b.png"}}},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1500x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"98178ac663fa1b1efba1ad201c15ab56","path":"/esgf-cookbook/build/98178ac663fa1b1efba1ad201c15ab56.png"}}},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1500x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"1664e1c18e14a5f886e6ada902e7b8ba","path":"/esgf-cookbook/build/1664e1c18e14a5f886e6ada902e7b8ba.png"}}},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1500x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"346043f757e963ef3ec5f26d3c34f8ff","path":"/esgf-cookbook/build/346043f757e963ef3ec5f26d3c34f8ff.png"}}}],"key":"D7IqClQcwQ"}],"key":"QhbVAVP3is"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Calculating annual mean for each dataset  and visualizing time series","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fWLNoBq6fO"}],"identifier":"calculating-annual-mean-for-each-dataset-and-visualizing-time-series","label":"Calculating annual mean for each dataset  and visualizing time series","html_id":"calculating-annual-mean-for-each-dataset-and-visualizing-time-series","implicit":true,"key":"s4krBjXQG7"}],"key":"jbUoO9hQ5v"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"annual_mean = {}\nfor key, regm in regn_mean.items():\n    annual_mean[key] = regm.resample(time='Y').mean()\n","key":"xRqDA09xuf"},{"type":"output","id":"Le_SUXCIpVX9yOFbOJWjr","data":[],"key":"Ftd0rFExr5"}],"key":"MMWhHl5fIj"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"annual_mean","visibility":"show","key":"PNfufoUY3j"},{"type":"output","id":"zxCHiIiq3_DMLmUOXfgh3","data":[{"output_type":"execute_result","execution_count":13,"metadata":{},"data":{"text/plain":{"content":"{'CMIP.CMCC.CMCC-ESM2.historical.Amon.gn': <xarray.DataArray 'tas' (time: 101)> Size: 404B\n dask.array<stack, shape=(101,), dtype=float32, chunksize=(1,), chunktype=numpy.ndarray>\n Coordinates:\n     height          float64 8B ...\n     member_id       <U8 32B 'r1i1p1f1'\n     dcpp_init_year  float64 8B nan\n   * time            (time) object 808B 1900-12-31 00:00:00 ... 2000-12-31 00:...,\n 'CMIP.CCCma.CanESM5.historical.Amon.gn': <xarray.DataArray 'tas' (time: 101)> Size: 404B\n dask.array<stack, shape=(101,), dtype=float32, chunksize=(1,), chunktype=numpy.ndarray>\n Coordinates:\n     height          float64 8B ...\n     member_id       <U8 32B 'r1i1p1f1'\n     dcpp_init_year  float64 8B nan\n   * time            (time) object 808B 1900-12-31 00:00:00 ... 2000-12-31 00:...,\n 'CMIP.NCAR.CESM2-FV2.historical.Amon.gn': <xarray.DataArray 'tas' (time: 101)> Size: 404B\n dask.array<stack, shape=(101,), dtype=float32, chunksize=(1,), chunktype=numpy.ndarray>\n Coordinates:\n     member_id       <U8 32B 'r1i1p1f1'\n     dcpp_init_year  float64 8B nan\n   * time            (time) object 808B 1900-12-31 00:00:00 ... 2000-12-31 00:...,\n 'CMIP.NCAR.CESM2.historical.Amon.gn': <xarray.DataArray 'tas' (time: 101)> Size: 404B\n dask.array<stack, shape=(101,), dtype=float32, chunksize=(1,), chunktype=numpy.ndarray>\n Coordinates:\n     member_id       <U8 32B 'r1i1p1f1'\n     dcpp_init_year  float64 8B nan\n   * time            (time) object 808B 1900-12-31 00:00:00 ... 2000-12-31 00:...}","content_type":"text/plain"}}}],"visibility":"show","key":"iWWDOeMM99"}],"visibility":"show","key":"ZMiI0GViat"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualizing the regional annual mean for each dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"L1sOaKrqAP"}],"identifier":"visualizing-the-regional-annual-mean-for-each-dataset","label":"Visualizing the regional annual mean for each dataset","html_id":"visualizing-the-regional-annual-mean-for-each-dataset","implicit":true,"key":"gwtBcO1QJf"}],"key":"lKB5p8LZ4M"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"for key, anmn in annual_mean.items():\n    source_id = key.split('.')[2]\n    anmn.plot(label=source_id)\n    plt.title(f\"Mean Annual Surface Air Temperature for {source_id}\")\n    plt.xlabel('Time')\n    plt.ylabel('Temperature (K)')\n    plt.legend()\n    plt.show()","visibility":"show","key":"l5W1LJRiJG"},{"type":"output","id":"cQV7Xt8Beo_7fZCykV64w","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1500x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"9e011e4de5d63cd241f3daca382d128f","path":"/esgf-cookbook/build/9e011e4de5d63cd241f3daca382d128f.png"}}},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1500x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"76806bc7678d503c85e6bef839fdefce","path":"/esgf-cookbook/build/76806bc7678d503c85e6bef839fdefce.png"}}},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1500x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"d86f07d6d6205f58f05261a60b0e9ae4","path":"/esgf-cookbook/build/d86f07d6d6205f58f05261a60b0e9ae4.png"}}},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1500x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"83c4968e5e271696b243f74117550048","path":"/esgf-cookbook/build/83c4968e5e271696b243f74117550048.png"}}}],"visibility":"show","key":"XtnltGr51T"}],"visibility":"show","key":"DQDNuesYRR"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualizing the regional annual mean for each dataset in a single panel","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cJlCFqrJkM"}],"identifier":"visualizing-the-regional-annual-mean-for-each-dataset-in-a-single-panel","label":"Visualizing the regional annual mean for each dataset in a single panel","html_id":"visualizing-the-regional-annual-mean-for-each-dataset-in-a-single-panel","implicit":true,"key":"ebcMziITU0"}],"key":"zuI8BlfMjJ"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Create the plot\nplt.figure(figsize=(12, 6))\n\n# Plotting the annual mean for each dataset on the same plot\nfor key, annm in annual_mean.items():\n    source_id = key.split('.')[2]\n    annm.plot(label=source_id)\n\nplt.title(\"Annual Mean Surface Air Temperature (Regional)\")\nplt.xlabel('Time')\nplt.ylabel('Temperature (K)')\nplt.legend()\nplt.show()\n","visibility":"show","key":"nku6orbmJ4"},{"type":"output","id":"LO4QdsbR8EllApVjLNWsE","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1200x600 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"ce0eb55c143684895ba6fae06383bcab","path":"/esgf-cookbook/build/ce0eb55c143684895ba6fae06383bcab.png"}}}],"visibility":"show","key":"CEsflshthf"}],"visibility":"show","key":"aNzull7xYr"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"References","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"f46yxzQAlo"}],"identifier":"references","label":"References","html_id":"references","implicit":true,"key":"Q14SbkeKWt"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"link","url":"https://projectpythia.org/cmip6-cookbook/notebooks/example-workflows/gmst.html","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Global Mean Surface Temperature","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"MBcZsIWvjU"}],"urlSource":"https://projectpythia.org/cmip6-cookbook/notebooks/example-workflows/gmst.html","key":"zxz7gQ6jyl"}],"key":"qAtPRgLk51"}],"key":"iNhO8FvKQc"}],"key":"BkJSLOal6I"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Demo: Regridding and Plotting with Rooki and Cartopy","url":"/notebooks/ex-regrid-plot","group":"Workflows"}}},"domain":"http://localhost:3000"}