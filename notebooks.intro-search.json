{"version":2,"kind":"Notebook","sha256":"713e8defc23476fdea57c8620984a0d5958315af3dfa22082d818b199512b46f","slug":"notebooks.intro-search","location":"/notebooks/intro-search.ipynb","dependencies":[],"frontmatter":{"title":"Introduction to intake-esgf","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Project Pythia Community","given":"Project Pythia","family":"Community"},"name":"Project Pythia Community","url":"https://projectpythia.org/","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true},"code":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true}},"github":"https://github.com/projectpythia/esgf-cookbook","copyright":"2023","affiliations":[{"id":"University at Albany (State University of New York)","name":"University at Albany (State University of New York)"},{"id":"UCAR/NCAR","name":"UCAR/NCAR"}],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/projectpythia/esgf-cookbook/blob/main/notebooks/intro-search.ipynb","thumbnail":"/esgf-cookbook/build/esgf2-us-901ae844355af132c5ed591c78734b5e.png","exports":[{"format":"ipynb","filename":"intro-search.ipynb","url":"/esgf-cookbook/build/intro-search-9a0fdb0f16d8846ebc290152faf5ce39.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"image","url":"/esgf-cookbook/build/esgf2-us-901ae844355af132c5ed591c78734b5e.png","alt":"ESGF logo","width":250,"key":"IfvYBQMnBV","urlSource":"images/logos/esgf2-us.png"}],"key":"KY5nUIiCsD"}],"key":"g4yyKFO1XF"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Introduction to ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xnD1GikSK2"},{"type":"inlineCode","value":"intake-esgf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EtmhVVeGkP"}],"identifier":"introduction-to-intake-esgf","label":"Introduction to intake-esgf","html_id":"introduction-to-intake-esgf","implicit":true,"key":"p8JHS9UwTn"},{"type":"heading","depth":2,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CoqivvTwEN"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"GINDap6eav"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"In this tutorial we will discuss the basic functionality of ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"WcH81sDuSI"},{"type":"link","url":"https://github.com/esgf2-us/intake-esgf","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"intake-esgf","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"oeCPUmVztl"}],"urlSource":"https://github.com/esgf2-us/intake-esgf","error":true,"key":"XuUgVeGBWx"},{"type":"text","value":" and describe some of what it is doing under the hood. ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"WQqkRyu1Rs"},{"type":"inlineCode","value":"intake-esgf","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"c0IWCHQvGL"},{"type":"text","value":" is an ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"xgXiMLdgX3"},{"type":"inlineCode","value":"intake","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"UYzqJpMu3g"},{"type":"text","value":" and ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"glruAvWz8s"},{"type":"inlineCode","value":"intake-esm","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ARE6BIm0CP"},{"type":"text","value":" ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"fP6yKeknfu"},{"type":"emphasis","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"inspired","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"GxXrOqpcES"}],"key":"hvMRGsh6r4"},{"type":"text","value":" package under development in ESGF2. Please note that there is a name collison with an existing package in PyPI and conda. You will need to install the package from ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"rsihSjm2lX"},{"type":"link","url":"https://github.com/esgf2-us/intake-esgf","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"source","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"c99Ob4EEVd"}],"urlSource":"https://github.com/esgf2-us/intake-esgf","error":true,"key":"li4VM07uaP"},{"type":"text","value":".","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ryMSqggsqz"}],"key":"LXXnFGITyG"},{"type":"heading","depth":2,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Prerequisites","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Np6FfYXTUy"}],"identifier":"prerequisites","label":"Prerequisites","html_id":"prerequisites","implicit":true,"key":"v1aNZXueRO"},{"type":"table","position":{"start":{"line":8,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Concepts","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"XN1iVUbCI7"}],"key":"BvvI5V5GQf"},{"type":"tableCell","header":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Importance","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"LKfYJGeTXB"}],"key":"YJmtO0qn1P"},{"type":"tableCell","header":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Notes","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"fxSWvisBmf"}],"key":"EEyrijfPS6"}],"key":"YNveHqGzwJ"},{"type":"tableRow","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"link","url":"https://github.com/esgf2-us/intake-esgf","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Install Package","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"UhaaZlgMi9"}],"urlSource":"https://github.com/esgf2-us/intake-esgf","error":true,"key":"oSccpgxh03"}],"key":"e5F8rDnmRC"},{"type":"tableCell","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"Omdgd2OORm"}],"key":"qV40wdV3JT"},{"type":"tableCell","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"inlineCode","value":"pip install git+https://github.com/esgf2-us/intake-esgf","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"FM6M7OF0kH"}],"key":"EKXcfamQkz"}],"key":"Y8QzkPnnQC"},{"type":"tableRow","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Familiar with ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"v81UTPT5Bj"},{"type":"link","url":"https://intake-esm.readthedocs.io/en/stable/","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"intake-esm","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"VVGhyUlmYW"}],"urlSource":"https://intake-esm.readthedocs.io/en/stable/","key":"jb6Jxwr6BA"}],"key":"C0qikGXJYm"},{"type":"tableCell","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"nwUWXSY1rR"}],"key":"UzBYSgDDy2"},{"type":"tableCell","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Similar interface","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"CCcUc1VQnm"}],"key":"v7I34yppiq"}],"key":"E1oQbzKxIf"},{"type":"tableRow","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"link","url":"https://foundations.projectpythia.org/core/data-formats/netcdf-cf.html","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Understanding of NetCDF","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"DenoDNkkoi"}],"urlSource":"https://foundations.projectpythia.org/core/data-formats/netcdf-cf.html","key":"v03CNXCcsT"}],"key":"VqXF9d4tgl"},{"type":"tableCell","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"qUNbXNps4V"}],"key":"j6R3Pbbkk8"},{"type":"tableCell","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Familiarity with metadata structure","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"KTsKKXWv3z"}],"key":"NtjwmJTTDJ"}],"key":"Y7m9HtrPTE"}],"key":"KxBZsI2gdl"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"strong","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Time to learn","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"OVMyycNayx"}],"key":"NWACvUEgwT"},{"type":"text","value":": 30 minutes","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"mzeYsmpNwH"}],"key":"AycQulMVrZ"}],"key":"IUogPvNhDh"},{"type":"heading","depth":2,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"NdcGijTQYW"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"BdvpcCNkax"}],"key":"nU1W8uMost"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from intake_esgf import ESGFCatalog\nimport matplotlib.pyplot as plt","key":"QW3I0ojGXm"},{"type":"output","id":"oQt2swiORR84Vc-5fJ_AO","data":[],"key":"XNwJvlNgfr"}],"key":"SMrvWnfQyW"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Populate the Catalog","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"C2Nq86QUW8"}],"identifier":"populate-the-catalog","label":"Populate the Catalog","html_id":"populate-the-catalog","implicit":true,"key":"f68cyCNrSU"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Unlike ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KyIix66H92"},{"type":"inlineCode","value":"intake-esm","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Y5PLDybbuK"},{"type":"text","value":", our catalogs initialize empty. This is because while ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"w3kEwTsxln"},{"type":"inlineCode","value":"intake-esm","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jGW5XF7HGW"},{"type":"text","value":"\nloads a large file-based database into memory, we are going to populate a catalog by\nsearching one or many index nodes. The ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dJ6P4OdGVv"},{"type":"inlineCode","value":"ESGFCatalog","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"c4zBOSk1SA"},{"type":"text","value":" is configured by default to query\na Globus (ElasticSearch) based index which has information about holdings at the (Argonne Leadership Computing Facility (ALCF) only. We will demonstrate how this may be expanded to include other nodes later.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"L1Q5ojD351"}],"key":"dxRhWGZBZE"}],"key":"PrrE7wV75B"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cat = ESGFCatalog()\nprint(cat)  # <-- nothing to see here yet","key":"zlpItjFvhS"},{"type":"output","id":"jJkoSiKTp1wxbV5q4N8zd","data":[{"output_type":"stream","name":"stdout","text":"Perform a search() to populate the catalog.\n"}],"key":"IeAhh5Rm97"}],"key":"PI2ZT7f721"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cat.search(\n    experiment_id=\"historical\",\n    source_id=\"CanESM5\",\n    frequency=\"mon\",\n    variable_id=[\"gpp\", \"tas\", \"pr\"],\n)\nprint(cat)","key":"xwdqHtuwWu"},{"type":"output","id":"66vvYjOKenxBLo7S-9Cu9","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"   Searching indices:   0%|          |0/1 [       ?index/s]","content_type":"text/plain"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"3f423095b92747bbbe96f97caa506160\"}","content_type":"application/vnd.jupyter.widget-view+json"}}},{"output_type":"stream","name":"stdout","text":"Summary information for 195 results:\nmip_era                                                     [CMIP6]\nactivity_drs                                                 [CMIP]\ninstitution_id                                              [CCCma]\nsource_id                                                 [CanESM5]\nexperiment_id                                          [historical]\nmember_id         [r10i1p1f1, r10i1p2f1, r11i1p1f1, r11i1p2f1, r...\ntable_id                                               [Amon, Lmon]\nvariable_id                                          [pr, tas, gpp]\ngrid_label                                                     [gn]\ndtype: object\n"}],"key":"e9wT0sTN08"}],"key":"NX2NXxTK7i"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The search has populated the catalog where results are stored internally as a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"be3aCWwYsg"},{"type":"inlineCode","value":"pandas","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vXXeSff2CD"},{"type":"text","value":" dataframe, where the columns are the facets common to ESGF. Printing the catalog will display each column as well as a possibly-truncated list of unique values. We can use these to help narrow down our search. In this case, we neglected to mention a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VVuCq5tHqX"},{"type":"inlineCode","value":"member_id","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Lc9IsKKwGv"},{"type":"text","value":" (also known as a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xd8rtqAHjD"},{"type":"inlineCode","value":"variant_label","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XH6E2emzn8"},{"type":"text","value":"). So we can repeat our search with this additional facet. Note that searches are not cumulative and so we need to repeat the previous facets in this subsequent search. Also, while for the tutorial’s sake we repeat the search here, in your own analysis codes, you could simply edit your previous search.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xReb3i3ZAl"}],"key":"lkMEJlsYu0"}],"key":"xJKob3pwzM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"cat.search(\n    experiment_id=\"historical\",\n    source_id=\"CanESM5\",\n    frequency=\"mon\",\n    variable_id=[\"gpp\", \"tas\", \"pr\"],\n    variant_label=\"r1i1p1f1\",  # addition from the last search\n)\nprint(cat)","key":"nnhP5np2lU"},{"type":"output","id":"q8jxHXazSH_zAwwp45ooi","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"   Searching indices:   0%|          |0/1 [       ?index/s]","content_type":"text/plain"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"902165dd22644bfca8ed0a59e8362048\"}","content_type":"application/vnd.jupyter.widget-view+json"}}},{"output_type":"stream","name":"stdout","text":"Summary information for 3 results:\nmip_era                  [CMIP6]\nactivity_drs              [CMIP]\ninstitution_id           [CCCma]\nsource_id              [CanESM5]\nexperiment_id       [historical]\nmember_id             [r1i1p1f1]\ntable_id            [Amon, Lmon]\nvariable_id       [pr, tas, gpp]\ngrid_label                  [gn]\ndtype: object\n"}],"key":"LS5KllYdYh"}],"key":"BOJKVHPi0T"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Obtaining the datasets","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tVOAn00ryl"}],"identifier":"obtaining-the-datasets","label":"Obtaining the datasets","html_id":"obtaining-the-datasets","implicit":true,"key":"ZlH1sOVBPu"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Now we see that our search has located 3 datasets and thus we are ready to load these into memory. Like ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bacViBL9lL"},{"type":"inlineCode","value":"intake-esm","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fTvk6knskf"},{"type":"text","value":", the catalog will generate a dictionary of ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bMmjITPdJH"},{"type":"inlineCode","value":"xarray","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aFYMCxz1Re"},{"type":"text","value":" datasets. Internally, the catalog is again communicating with the index node and requesting file information. This includes which file or files are part of the datasets, their local paths, download locations, and verification information. We then try to make an optimal decision in getting the data to you as quickly as we can.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DJ1F6ozFdn"}],"key":"mphkLYjWCf"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"If you are running on a resource with direct access to the ESGF holdings (such a Jupyter notebook on ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"V8qVwer3d9"},{"type":"link","url":"http://nimbus.llnl.gov","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"nimbus.llnl.gov","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"oGEOrft1Xp"}],"urlSource":"http://nimbus.llnl.gov","key":"qap52z88Gq"},{"type":"text","value":"), then we check if the dataset files are locally available. We have a handful of locations built-in to ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"GWsaMGXs5C"},{"type":"inlineCode","value":"intake-esgf","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"odo8zLxSs7"},{"type":"text","value":" but you can also set a location manually with ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"p272nsa3Ze"},{"type":"inlineCode","value":"cat.set_esgf_data_root()","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ZmJe4Sdgtq"},{"type":"text","value":".","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"KT541BTLn1"}],"key":"vdz8ILmI7L"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"If a dataset has associated files that have been previously downloaded into the local cache, then we will load these files into memory.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"p6tSeSSkQA"}],"key":"K3xjdWKaeP"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"If no direct file access is found, then we will queue the dataset files for download. File downloads will occur in parallel from the locations which provide you the fastest transfer speeds. Initially we will randomize the download locations, but as you use ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"bfFV26wNG6"},{"type":"inlineCode","value":"intake-esgf","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"c3QOyxTUEO"},{"type":"text","value":", we keep track of which servers provide you fastest transfer speeds and future downloads will prefer these locations. Once downloaded, we check file validity, and load into ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"q8Oycb8bB6"},{"type":"inlineCode","value":"xarray","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ZVa5Xu1I6n"},{"type":"text","value":" containers.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"PGSIOVpJ4H"}],"key":"H5qvQhUfZj"}],"key":"bvjP1kpY9t"}],"key":"O14Z4qVIIy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"dsd = cat.to_dataset_dict()","key":"bXlW643kSC"},{"type":"output","id":"5f89T21QCW67o7zHVRl0V","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"Get file information:   0%|          |0/1 [       ?index/s]","content_type":"text/plain"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"491a48fc1233417a984059c9fffad6d7\"}","content_type":"application/vnd.jupyter.widget-view+json"}}},{"output_type":"stream","name":"stdout","text":"Downloading 131.5 [Mb]...\n"},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"tas_Amon_CanESM5_historical_r1i1p1f1_...:   0%|          |0.00/52.4M [?B/s]","content_type":"text/plain"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"8a1c6e33143b4072b9026ba6cda4df27\"}","content_type":"application/vnd.jupyter.widget-view+json"}}},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"gpp_Lmon_CanESM5_historical_r1i1p1f1_...:   0%|          |0.00/19.2M [?B/s]","content_type":"text/plain"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"96dceb4a15cb496d822637d8a6c2d7e9\"}","content_type":"application/vnd.jupyter.widget-view+json"}}},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"pr_Amon_CanESM5_historical_r1i1p1f1_g...:   0%|          |0.00/59.9M [?B/s]","content_type":"text/plain"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"dcbf1288cd2a484bb1c76b0ed56f8536\"}","content_type":"application/vnd.jupyter.widget-view+json"}}},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"Adding cell measures:   0%|          |0/3 [     ?dataset/s]","content_type":"text/plain"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"0920bea9e8df4e29ac817ee230f10819\"}","content_type":"application/vnd.jupyter.widget-view+json"}}},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"areacella_fx_CanESM5_historical_r1i1p...:   0%|          |0.00/51.9k [?B/s]","content_type":"text/plain"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"ccbce46f02d64f25b5fbb7fb329c4d63\"}","content_type":"application/vnd.jupyter.widget-view+json"}}},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"sftlf_fx_CanESM5_historical_r1i1p1f1_...:   0%|          |0.00/59.8k [?B/s]","content_type":"text/plain"},"application/vnd.jupyter.widget-view+json":{"content":"{\"version_major\":2,\"version_minor\":0,\"model_id\":\"baf0768ae78242169a28f624ae9c8a65\"}","content_type":"application/vnd.jupyter.widget-view+json"}}}],"key":"I0tBwBDp3s"}],"key":"tg92BPcm5a"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"You will notice that progress bars inform you that file information is being obtained\nand that downloads are taking place. As files are downloaded, they are placed into a\nlocal cache in ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ySsFjrgkke"},{"type":"inlineCode","value":"${HOME}/.esgf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DSHy8E9t3w"},{"type":"text","value":" in a directory structure that mirrors that of the\nremote storage. For future analysis which uses these datasets, ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VfIVrZ036o"},{"type":"inlineCode","value":"intake-esgf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tyYMp3lD8n"},{"type":"text","value":" will\nfirst check this cache to see if a file already exists and use it instead of\nre-downloading. Then it returns a dictionary whose keys are by default the minimal set\nof facets to uniquely describe a dataset in the current search.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bsINR2iioQ"}],"key":"l6FKnfPYAI"}],"key":"e5yilM3ZRs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(dsd.keys())","key":"gyZvlB5vlc"},{"type":"output","id":"zHatqQD8qH_Mum2b7glFI","data":[{"output_type":"stream","name":"stdout","text":"dict_keys(['Amon.pr', 'Amon.tas', 'Lmon.gpp'])\n"}],"key":"syG1qwiqY1"}],"key":"s7j2EwBLol"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"During the download process, you may have also noticed that a progress bar informed\nyou that we were adding cell measures. If you have worked with ESGF data before, you\nknow that cell measure information like ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cVJ7jY7ss8"},{"type":"inlineCode","value":"areacella","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rR9ryLsxPz"},{"type":"text","value":" is needed to take proper\narea-weighted means/summations. Yet many times, model centers have not uploaded this\ninformation uniformly in all submissions. We perform a search for each dataset being\nplaced in the dataset dictionary, progressively dropping dataset facets to find, if\npossible, the cell measures that are ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JdG6vQD0iZ"},{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"closest","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"koSgHvkHk8"}],"key":"J5xGgUcSJh"},{"type":"text","value":" to the dataset being downloaded.\nSometimes they are simply in another ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OmDZkV74ic"},{"type":"inlineCode","value":"variant_label","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FhCGY7ka7F"},{"type":"text","value":", but other times they could be in a\ndifferent ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XNxHX73ZpQ"},{"type":"inlineCode","value":"activity_id","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qCJmrV5Ry9"},{"type":"text","value":". No matter where they are, we find them for you and add them\nby default (disable with ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cFYAUeFaFb"},{"type":"inlineCode","value":"to_dataset_dict(add_measures=False)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZYrO9sgxGK"},{"type":"text","value":").","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ypv4Nk6Px0"}],"key":"IhYdd6bynD"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"We determine which measures need downloaded by looking in the dataset attributes. Since ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"VdkqINjPfB"},{"type":"inlineCode","value":"tas","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"T6z5ZOGADt"},{"type":"text","value":" is an atmospheric variable, we will see that its ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"JoRqBOdMu8"},{"type":"inlineCode","value":"cell_measures = 'area: areacella'","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"XQlYhSGC28"},{"type":"text","value":". If you print this variable you will see that measure has been added.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"VXEKM9Q8R3"}],"key":"PVgEUHTqOq"}],"key":"rsiuk7iC2Z"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"dsd[\"Amon.tas\"]","key":"MWtPD5u0oU"},{"type":"output","id":"kJnCSosq7sopsRKWQfM5g","data":[{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/plain":{"content":"<xarray.Dataset> Size: 65MB\nDimensions:    (time: 1980, bnds: 2, lat: 64, lon: 128)\nCoordinates:\n  * time       (time) object 16kB 1850-01-16 12:00:00 ... 2014-12-16 12:00:00\n  * lat        (lat) float64 512B -87.86 -85.1 -82.31 ... 82.31 85.1 87.86\n  * lon        (lon) float64 1kB 0.0 2.812 5.625 8.438 ... 351.6 354.4 357.2\n    height     float64 8B ...\nDimensions without coordinates: bnds\nData variables:\n    time_bnds  (time, bnds) object 32kB ...\n    lat_bnds   (lat, bnds) float64 1kB ...\n    lon_bnds   (lon, bnds) float64 2kB ...\n    tas        (time, lat, lon) float32 65MB ...\n    areacella  (lat, lon) float32 33kB ...\nAttributes: (12/55)\n    CCCma_model_hash:            3dedf95315d603326fde4f5340dc0519d80d10c0\n    CCCma_parent_runid:          rc3-pictrl\n    CCCma_pycmor_hash:           33c30511acc319a98240633965a04ca99c26427e\n    CCCma_runid:                 rc3.1-his01\n    Conventions:                 CF-1.7 CMIP-6.2\n    YMDH_branch_time_in_child:   1850:01:01:00\n    ...                          ...\n    variant_label:               r1i1p1f1\n    version:                     v20190429\n    license:                     CMIP6 model data produced by The Government ...\n    cmor_version:                3.4.0\n    activity_drs:                CMIP\n    member_id:                   r1i1p1f1","content_type":"text/plain"},"text/html":{"content_type":"text/html","hash":"75f5300f3e35e7f59a20a32ba5636069","path":"/esgf-cookbook/build/75f5300f3e35e7f59a20a32ba5636069.html"}}}],"key":"fvKMGJloBv"}],"key":"a5yS18LUto"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"However, for ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rQiKuYV6mv"},{"type":"inlineCode","value":"gpp","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uktis2a6di"},{"type":"text","value":" we also need the land fractions, which is detected by the presence of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"h00l9MIAkx"},{"type":"inlineCode","value":"area: where land","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VERBYv83Wo"},{"type":"text","value":" in the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZsaISixZfR"},{"type":"inlineCode","value":"cell_methods","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iPJrQ03u9Z"},{"type":"text","value":". You will notice that both ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BgL9A8JHgA"},{"type":"inlineCode","value":"areacella","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tvSUhnCFCT"},{"type":"text","value":" and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TYbxYmY2Lj"},{"type":"inlineCode","value":"sftlf","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pLIJnhWWM6"},{"type":"text","value":" are added to ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mOrzILNWfu"},{"type":"inlineCode","value":"Lmon.gpp","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eKGF7zPD3z"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LXFl1nqJSv"}],"key":"gCn2hyS7Gb"}],"key":"icmMRydcQc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"dsd[\"Lmon.gpp\"]","key":"Pr9O1UXW5r"},{"type":"output","id":"ckh-jMP5MEKnXblsAB1rX","data":[{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/plain":{"content":"<xarray.Dataset> Size: 65MB\nDimensions:    (time: 1980, bnds: 2, lat: 64, lon: 128)\nCoordinates:\n  * time       (time) object 16kB 1850-01-16 12:00:00 ... 2014-12-16 12:00:00\n  * lat        (lat) float64 512B -87.86 -85.1 -82.31 ... 82.31 85.1 87.86\n  * lon        (lon) float64 1kB 0.0 2.812 5.625 8.438 ... 351.6 354.4 357.2\n    type       |S4 4B ...\nDimensions without coordinates: bnds\nData variables:\n    time_bnds  (time, bnds) object 32kB ...\n    lat_bnds   (lat, bnds) float64 1kB ...\n    lon_bnds   (lon, bnds) float64 2kB ...\n    gpp        (time, lat, lon) float32 65MB ...\n    areacella  (lat, lon) float32 33kB ...\n    sftlf      (lat, lon) float32 33kB ...\nAttributes: (12/55)\n    CCCma_model_hash:            3dedf95315d603326fde4f5340dc0519d80d10c0\n    CCCma_parent_runid:          rc3-pictrl\n    CCCma_pycmor_hash:           33c30511acc319a98240633965a04ca99c26427e\n    CCCma_runid:                 rc3.1-his01\n    Conventions:                 CF-1.7 CMIP-6.2\n    YMDH_branch_time_in_child:   1850:01:01:00\n    ...                          ...\n    variant_label:               r1i1p1f1\n    version:                     v20190429\n    license:                     CMIP6 model data produced by The Government ...\n    cmor_version:                3.4.0\n    activity_drs:                CMIP\n    member_id:                   r1i1p1f1","content_type":"text/plain"},"text/html":{"content_type":"text/html","hash":"f254617aaa31ebd68a54ccb50a6cbfb9","path":"/esgf-cookbook/build/f254617aaa31ebd68a54ccb50a6cbfb9.html"}}}],"key":"DQ1nx2VBtu"}],"key":"DArvGNWZI1"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Simple Plotting","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lIepfqo3xM"}],"identifier":"simple-plotting","label":"Simple Plotting","html_id":"simple-plotting","implicit":true,"key":"uJ5knYJsHs"}],"key":"jfjKl5lwsY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, axs = plt.subplots(figsize=(6, 12), nrows=3)\n\n# temperature\nds = dsd[\"Amon.tas\"][\"tas\"].mean(dim=\"time\") - 273.15  # to [C]\nds.plot(ax=axs[0], cmap=\"bwr\", vmin=-40, vmax=40, cbar_kwargs={\"label\": \"tas [C]\"})\n\n# precipitation\nds = dsd[\"Amon.pr\"][\"pr\"].mean(dim=\"time\") * 86400 / 999.8 * 1000  # to [mm d-1]\nds.plot(ax=axs[1], cmap=\"Blues\", vmax=10, cbar_kwargs={\"label\": \"pr [mm d-1]\"})\n\n# gross primary productivty\nds = dsd[\"Lmon.gpp\"][\"gpp\"].mean(dim=\"time\") * 86400 * 1000  # to [g m-2 d-1]\nds.plot(ax=axs[2], cmap=\"Greens\", cbar_kwargs={\"label\": \"gpp [g m-2 d-1]\"})\n\nplt.tight_layout();","key":"oPoGWmj10M"},{"type":"output","id":"_qdkuhXYquy-Rlhm-NmA-","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 600x1200 with 6 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"ea1dc6f415181c24be6635cae0f828fc","path":"/esgf-cookbook/build/ea1dc6f415181c24be6635cae0f828fc.png"}}}],"key":"NIlZJ86kXj"}],"key":"zGPwmkIlzx"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Summary","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZihwlY5tPz"}],"identifier":"summary","label":"Summary","html_id":"summary","implicit":true,"key":"D0jLJZKoCV"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"intake-esgf","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LwpBnjESTq"},{"type":"text","value":" becomes the way that you download or locate data as well as load it into memory. It is a full specification of what your analysis is about and makes your script portable to other machines or even in use with serverside computing. We are actively developing this codebase. Let us ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ojkny4tWNG"},{"type":"link","url":"https://github.com/esgf2-us/intake-esgf/issues","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"know","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kWGtx5SEpV"}],"urlSource":"https://github.com/esgf2-us/intake-esgf/issues","error":true,"key":"g8CYF3MRAz"},{"type":"text","value":" what other features you would like to see.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ZAVtKMrksc"}],"key":"BUYRKtQnkI"}],"key":"RLfGp5kaEf"}],"key":"wDhu0WfOtO"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Running Notebooks on Nimbus","url":"/notebooks/running-on-nimbus","group":"Preamble"},"next":{"title":"Complex Searching with intake-esgf","url":"/notebooks/complex-search","group":"Searching"}}},"domain":"http://localhost:3000"}